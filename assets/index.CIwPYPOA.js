import{E as K,F as Q,G as q,o as O,H as P,c as F,_ as J,r as M,I as X,t as c,v as d,x as r,J as n,K as L,y as k,z as N,A as Y,L as Z,T as W,M as B,N as H,O as j,P as ee,B as te,C as ae,D as ne,Q as se}from"./entry.IzOAQ1OH.js";import{u as oe}from"./vue.f36acd1f.Ca-MVfSs.js";function re(b,x={}){return oe(b,{...x,transform:K})}const R=Q("calendarStore",()=>{const b=Object.freeze(["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]),x=Object.freeze(["пн","вт","ср","чт","пт","сб","вс"]),I=Object.freeze(["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"]),g=Object.freeze(new Date),v=(e,l)=>{switch(e){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 3:case 5:case 8:case 10:return 30;case 1:return l%4===0?29:28;default:return-1}},m=q({});O(()=>{if(!localStorage.getItem("tasks"))return;const e=JSON.parse(localStorage.getItem("tasks"));Object.assign(m,e)});const A=(e,l,f)=>m[e]&&m[e][l]&&m[e][l][f]||[],$=(e,l,f)=>{const h=l.getFullYear(),y=l.getMonth(),i=l.getDate();switch(f){case"add":{m[h]||(m[h]={}),m[h][y]||(m[h][y]={}),m[h][y][i]||(m[h][y][i]=[]),m[h][y][i].push(e);break}case"remove":{if(!(m[h]&&m[h][y]&&m[h][y][i]))return;const a=m[h][y][i],t=a.findIndex(w=>w.id===e.id);if(t===-1)return;a.splice(t,1);break}}localStorage.setItem("tasks",JSON.stringify(m))},_=P(new Date),E=F(()=>_.value),T=(e,l=null)=>{switch(e){case"monthForward":{_.value=new Date(_.value.getFullYear(),_.value.getMonth()+1);return}case"monthBackward":{_.value=new Date(_.value.getFullYear(),_.value.getMonth()-1);return}case"set":{if(!l)return;_.value=l;return}default:return}},S=e=>{let l=e.getMonth(),f=e.getFullYear(),h=e.getDay()-1;h<0&&(h+=7);let y=e.getDate()%7;h-y<0&&(y-=7);let i=(1-y+h)%7,a=i,t=v(l,f),w=Math.ceil((t+i)/7),s=Math.floor(t/7)*7,u=0;for(;s<t;)if(i=(i+1)%7,s++,u++,u>100){console.warn(`calcMatrixLimits Error in while Cycle, tmp = ${s}, firstDayIndex = ${i}`);break}let o=7-i;return{additionalDaysBefore:a,additionalDaysAfter:o,daysInMonth:t,rows:w,month:l,year:f}},D=F(()=>{const e=S(_.value),l=e.additionalDaysBefore,f=[];let h=0;if(e.additionalDaysBefore){const a=e.month-1<0?11:e.month-1,t=e.month===0?e.year-1:e.year;h=v(a,t)}let y=e.additionalDaysAfter?1:0;const i=v(e.month,e.year);for(let a=0;a<e.rows;a++){const t=[];for(let w=0;w<7;w++){const s={year:e.year,month:e.month,day:a*7+w-l+1,tasks:[]};a===0&&e.additionalDaysBefore?(s.month--,s.day=h-(e.additionalDaysBefore-1),e.additionalDaysBefore--):a===e.rows-1&&e.additionalDaysAfter&&s.day>i?(s.month++,s.day=y++,e.additionalDaysAfter--):s.day=a*7+w-l+1,s.month<0&&(s.month=11,s.year--),s.tasks=A(s.year,s.month,s.day),t.push(s)}f.push(t)}return f});return{monthTitles:b,dayTitlesShort:x,dayTitlesFull:I,getChosenDate:E,updateChosenDate:T,updateTasks:$,getTasks:A,currentDate:g,matrix:D}}),le={class:"calendar-grid-wrapper"},ie={class:"month-select"},ce={class:"table__row"},de={class:"table__cell table__cell-header"},ue=["month","year","day","dayIndex","tasks"],me=["month"],he=["year"],ye={__name:"calendarGridComp",emits:["daySelected"],setup(b,{emit:x}){const I=x,g=R(),v=g.dayTitlesShort,m=g.monthTitles,A=g.currentDate,$=F(()=>g.matrix),_=F(()=>g.getChosenDate),E=F(()=>_.value.getMonth()),T=F(()=>_.value.getFullYear());let S=M(_.value.getFullYear()),D=M(null);X(T,i=>S.value=i);let e=M(0);const l=i=>{switch(e.value){case 0:D.value=null;break;case 1:i===1&&(D.value=null);break;case 2:break;default:console.warn("updateCurrentWindow Error",i);return}e.value+=i},f=i=>{g.updateChosenDate(i)},h=i=>{let a=i.target;for(;a&&!(a!=null&&a.classList.contains("table__cell-data"));)a=a.parentElement;a&&I("daySelected",a.getAttribute("year"),a.getAttribute("month"),a.getAttribute("day"),a.getAttribute("dayIndex"))},y=(i,a)=>{if(!a)return;let t=i.target;for(;t&&(t==null?void 0:t.tagName)!=="BUTTON";)t=t.parentElement;if(t)switch(a){case"month":{D.value=t.getAttribute("month"),l(-1),g.updateChosenDate("set",new Date(S.value,D.value));break}case"year":{S.value=t.getAttribute("year"),l(-1);break}default:{console.warn("dateSelectHandler Error",i,a);return}}};return(i,a)=>(c(),d("div",le,[r("div",ie,[n(e)===0?(c(),d("button",{key:0,onClick:a[0]||(a[0]=t=>f("monthBackward"))},"❮")):L("",!0),n(e)===0?(c(),d("h4",{key:1,onClick:a[1]||(a[1]=t=>l(1))},k(n(m)[n(E)])+" "+k(n(S))+"г. ",1)):n(e)===1?(c(),d("h4",{key:2,onClick:a[2]||(a[2]=t=>l(1))},k(n(S))+"г.",1)):(c(),d("h4",{key:3,onClick:a[3]||(a[3]=t=>l(-1))},"Выберите год")),n(e)===0?(c(),d("button",{key:4,onClick:a[4]||(a[4]=t=>f("monthForward"))},"❯")):L("",!0)]),N(W,{name:"fade",mode:"out-in"},{default:Y(()=>[n(e)===0?(c(),Z(W,{key:0,name:"fade",mode:"out-in"},{default:Y(()=>[(c(),d("div",{class:"table",onClick:h,key:n(_)},[r("div",ce,[(c(!0),d(B,null,H(n(v),t=>(c(),d("div",de,[r("h5",null,k(t),1)]))),256))]),(c(!0),d(B,null,H(n($),(t,w)=>(c(),d("div",{class:"table__row",key:w},[(c(!0),d(B,null,H(t,(s,u)=>(c(),d("div",{class:j({table__cell:!0,"table__cell-data":!0,inactive:s.month!==n(E),"have-task":s.tasks.length!==0,today:s.day===n(A).getDate()&&s.month===n(A).getMonth()&&s.year===n(A).getFullYear()}),key:`${s.year}${s.month}${s.day}`,month:s.month,year:s.year,day:s.day,dayIndex:u,tasks:s.tasks},[r("span",null,k(s.day),1)],10,ue))),128))]))),128))]))]),_:1})):n(e)===1?(c(),d("div",{key:1,class:"table table-select",onClick:a[5]||(a[5]=t=>y(t,"month"))},[(c(),d(B,null,H(12,t=>r("div",{class:"table-select__cell table-select__cell-month",key:n(m)[t-1]},[r("button",{month:t-1},k(n(m)[t-1]),9,me)])),64))])):(c(),d("div",{key:2,class:"table table-select",onClick:a[6]||(a[6]=t=>y(t,"year"))},[(c(),d(B,null,H(20,t=>r("div",{class:"table-select__cell table-select__cell-year",key:t},[r("button",{year:n(T)-10+t},k(n(T)-10+t),9,he)])),64))]))]),_:1})]))}},_e=J(ye,[["__scopeId","data-v-0121a5fb"]]),z=b=>(ae("data-v-d51f5a35"),b=b(),ne(),b),fe={class:"calendar-tasks-wrapper"},pe={class:"date"},ke={key:0,class:"tasks"},ve=["taskIndex"],ge=z(()=>r("div",{class:"buttons"},[r("button",{class:"watch accept round",action:"watch"},[r("span",null,"👁")]),r("button",{class:"abort round",action:"remove"},[r("span",null,"-")])],-1)),we={key:1},be=z(()=>r("span",null,"+",-1)),xe=[be],De={key:1,class:"add-task"},Ce=z(()=>r("span",null,":",-1)),Te=z(()=>r("span",null,"-",-1)),Se=z(()=>r("span",null,":",-1)),Ae={key:0,class:"watch-task"},Ie={class:"title"},Me={class:"description"},$e={class:"time"},Be={__name:"calendarTasksComp",props:["dateArguments"],emits:["close-window"],setup(b,{emit:x}){const I=x,g=b,v=R(),m=v.monthTitles,A=v.dayTitlesFull,$=()=>{switch(y.value){case"main":{I("close-window");break}case"add-task":case"watch-task":{y.value="main";break}}},_=g.dateArguments,E=_.pop(),T=new Date(..._),S=M(null),D=M(null),e=M(null),l=P(null),f=u=>{u.style.boxShadow="0 0 15px 5px red",setTimeout(()=>u.style.boxShadow="",500)},h=F(()=>v.getTasks(..._)),y=M("main"),i=()=>{var u;return Array.from((u=S.value)==null?void 0:u.children).filter(o=>o.tagName==="INPUT")},a=()=>{const u=i(),o=u.map(G=>+G.value),p=D.value.value,C=e.value.value,V=o[0]*60+o[1],U=o[2]*60+o[3];if(!p){f(D.value);return}if(!C){f(e.value);return}if(U<V){f(u[2]),f(u[3]);return}v.updateTasks({title:p,description:C,id:new Date().getTime(),time:{from:V,to:U}},T,"add"),D.value.value="",e.value.value="",u.forEach(G=>G.value="00")},t=u=>{const o=u.target,p=+Math.floor(o.value),C=+o.getAttribute("max"),V=+o.getAttribute("min");p>C||p<V?o.value=C:o.value=p<10?"0"+p:p},w=u=>{let o=u.target,p=null;for(;o&&o.tagName!=="LI";)o.tagName==="BUTTON"&&(p=o.getAttribute("action")),o=o.parentElement;if(!p)return;const C=h.value[o.getAttribute("taskIndex")];switch(p){case"watch":{l.value=C,y.value="watch-task";break}case"remove":{v.updateTasks(C,T,"remove");break}}},s=u=>{let o=Math.floor(u/60);return u%=60,o<10&&(o="0"+o),u<10&&(u="0"+u),`${o}:${u}`};return(u,o)=>(c(),d("div",fe,[r("h3",pe,k(n(m)[n(T).getMonth()])+" "+k(n(T).getDate())+" число, "+k(n(A)[n(E)]),1),r("button",{class:"back abort",onClick:$},"➥"),N(W,{name:"fade",mode:"out-in"},{default:Y(()=>[n(y)==="main"?(c(),d("div",ke,[N(W,{name:"fade",mode:"out-in"},{default:Y(()=>[n(h).length>0?(c(),d("ul",{key:0,onClick:w},[N(ee,{name:"tasks"},{default:Y(()=>[(c(!0),d(B,null,H(n(h),(p,C)=>(c(),d("li",{taskIndex:C,key:p.id},[te(k(p.title)+" ",1),ge],8,ve))),128))]),_:1})])):(c(),d("span",we,"Пусто... Попробуйте добавить новые задачи на данную дату"))]),_:1}),r("button",{class:"accept",onClick:o[0]||(o[0]=p=>y.value="add-task")},xe)])):n(y)==="add-task"?(c(),d("div",De,[r("input",{type:"text",ref_key:"titleElement",ref:D,placeholder:"Заголовок"},null,512),r("textarea",{ref_key:"descriptionElement",ref:e,placeholder:"Описание"},null,512),r("div",{class:"select-time",ref_key:"timeContainer",ref:S},[r("input",{onBlur:t,type:"number",value:"00",min:"0",max:"23"},null,32),Ce,r("input",{onBlur:t,type:"number",value:"00",min:"0",max:"58"},null,32),Te,r("input",{onBlur:t,type:"number",value:"00",min:"0",max:"23"},null,32),Se,r("input",{onBlur:t,type:"number",value:"00",min:"0",max:"59"},null,32)],512),r("button",{class:"add accept",onClick:a},"Добавить")])):n(y)==="watch-task"?(c(),d(B,{key:2},[n(l)?(c(),d("div",Ae,[r("h4",Ie,k(n(l).title),1),r("p",Me,k(n(l).description),1),r("div",$e," С "+k(s(n(l).time.from))+" до "+k(s(n(l).time.to)),1)])):L("",!0)],64)):L("",!0)]),_:1})]))}},Fe=J(Be,[["__scopeId","data-v-d51f5a35"]]),Ne={__name:"index",setup(b){re({title:"Календарь",link:[{rel:"icon",type:"image/png",href:"/icon.png"}]});const x=M(!1);let I=P([]);const g=(...m)=>{I.value=m,x.value=!0},v=()=>x.value=!1;return(m,A)=>{const $=_e,_=Fe;return c(),d("div",null,[N($,{onDaySelected:g}),N(W,{name:"fade"},{default:Y(()=>[n(x)?(c(),d("div",{key:0,class:"bg-block",onClick:se(v,["self"])},[N(_,{onCloseWindow:v,dateArguments:n(I)},null,8,["dateArguments"])])):L("",!0)]),_:1})])}}},Ye=J(Ne,[["__scopeId","data-v-29fa52e6"]]);export{Ye as default};
